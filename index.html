<html>
	<head>
		<script src="js/mail-generator.js"></script>
		<link href="css/style.css" rel="stylesheet" media="screen">
    <script>
      window.onload = function(){

        function loadPage(array) {
          for(var i=0; i<geemails.length;i++) {//go through email array
            outputEmail(array[i],i);  ////create email line

            //back button functionality to email window
            var back = document.getElementById("backButton");
            back.addEventListener("click",showList);

            document.getElementById("inboxCounter").innerHTML = geemails.length;
          }
        }
        function showList() {
          //hide email window
          var messageShow = document.getElementById("messageDisplay");
          messageShow.style.display = "none"; 
          //show email list
          var messageList = document.getElementById("mailDisplay");
          messageList.style.display = "flex";

        }

        function outputEmail(mailObj, arrayId) { //put together email, put on display
          var message = document.createElement("div");
          message.className = "email";
          
          var sender = emailSection("sender", mailObj);
          message.appendChild(sender);
          
          var subject = emailSection("subject", mailObj);
          message.appendChild(subject);

          var dateFormatted = formatDate(mailObj.date);
          var dateDiv = emailSection("date",dateFormatted);
          message.appendChild(dateDiv);

          var id = emailSection("arrayId", arrayId);
          message.appendChild(id);


          message.addEventListener("click",showMessage);
          //append message to mailDisplay, on webpage
          mailDisplay.appendChild(message);
        }

        function formatDate(rawDate) { //format date into something shorter
          var dateArray = rawDate.toString().split(" ");
          var date = dateArray[4].slice(0,5);

          for(var i= 1;i<3;i++) {
            date = date.concat(" ", dateArray[i]);
          }
          return date;
        }

        function emailSection(string, contents) {  //generate sections of the email
          var section = document.createElement("div");
          section.className = string;
          if(typeof contents === "object") {
            section.innerHTML = contents[string]; 
          } else {
            section.innerHTML = contents;
          }
          return section;
        }

        function showMessage() { //display email body when clicked
          //change message to visited
          this.className = "emailVisited";
          console.log(this);

          //show email in main window, hide email list
          var messageWindow =document.getElementById("messageDisplay");
          var messageList =document.getElementById("mailDisplay");
          
          messageWindow.style.display = "flex";
          messageList.style.display = "none";

          //get info to display email
          var subject = this.querySelector(".subject").innerHTML;
          var sender = this.querySelector(".sender").innerHTML;
          var date = this.querySelector(".date").innerHTML;
          var bodyId = this.querySelector(".arrayId").innerHTML;
          var body = geemails[bodyId].body;

          //display email in appropriate window
          document.getElementById("emailSubject").innerHTML = subject;
          document.getElementById("emailSender").innerHTML = sender;
          document.getElementById("emailDate").innerHTML = date;
          document.getElementById("emailContents").innerHTML = body;
        }


        function newMessage() {  //generate new email?
          var message = getNewMessage(); //generate email
          //console.log("message",message); //check contents
          geemails.push(message); //add new email to end of geemails array
          outputEmail(message,(geemails.length - 1));
          //console.log(geemails.length); //how many emails now?
        }

        function refreshInbox() {
          var inboxCounter = document.getElementById("inboxCounter");
          if(Number(inboxCounter.innerHTML) !== geemails.length) {
            inboxCounter.innerHTML = geemails.length;
            inboxCounter.className = "dynamic";
          } else {
            inboxCounter.className = "static";
          }
        }



//functions being called
        loadPage(geemails);
        setInterval(newMessage,6000); //generate new email at set intervals
        setInterval(refreshInbox,1000); //refresh inbox counter
        
      };
    </script>
	</head>
	<body>
		<div class="container" id="main">
      <header>
        <div id="title">
         <img src="images/gee.png" alt="gee" id="geeTitle">
         <h1 id="mailTitle">Mail</h1>
        </div>
        <div id="inbox">
          Inbox(<div id="inboxCounter" class="static"></div>)
        </div>
      </header>    
      <div id="mailDisplay"> 
      </div>  
      <div id="messageDisplay">
        <div id="emailHeader">
          <div id="backButton"> < </div>
          <p id="emailSubject" class="subject">subject</p>
        </div>
        <div id="emailInfo">
          <div id="emailSender" class="sender">sender</div>
          <div id="emailDate" class="date">date</div>
        </div>
        <div id="emailContents">
        </div>
      </div>
		</div>
	</body>
</html>

